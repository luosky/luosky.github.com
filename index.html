
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Luosky's Playground</title>
  <meta name="author" content="Luosky">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://luosky.github.com/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Luosky's Playground" type="application/atom+xml">
  

<!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-150010-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Luosky's Playground</a></h1>
  
    <h2>It's better to burn out than to fade away.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:luosky.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="http://photo.luosky.com">Mobile Photoes</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/06/21/passkit-passbook-api-study-notes/">PassKit (PassBook Api) 学习笔记</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-06-21T21:40:00+08:00" pubdate data-updated="true">Jun 21<span>st</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/06/21/passkit-passbook-api-study-notes/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h2>PassKit 学习笔记</h2>

<p>PassBook里存放的是一个个电子凭证(pass),这些pass可以是兑换券,机票,门票等,这些pass可以通过各种第三方app,网站,或者email进行安装. PassBook本身不提供这些pass,只是提供了一个查看这些pass,以及接受pass更新的平台. PassKit则是这个平台开放的API.</p>

<h3>pass的安装方式</h3>

<ol>
<li>通过网站下载 (MIME type: application/vnd-com.apple.pkpass)</li>
<li>通过email下载</li>
<li>通过提供pass的app安装</li>
</ol>


<h3>pass type identifier</h3>

<p>必须在developer.apple.com里注册自己pass type identifier</p>

<h3>pass的类型</h3>

<ul>
<li>boardingPass</li>
<li>coupon</li>
<li>eventTicket</li>
<li>storeCard  余额卡,必须指定余额值</li>
<li>generic</li>
</ul>


<h3>pass的提醒方式</h3>

<p><strong>预先指定的提醒:</strong></p>

<ul>
<li>时间 &#8211;当时间接近时可在锁屏界面提醒用户相关信息</li>
<li>地点 &#8211;当用户接近指定地点时提醒用户相关信息(指定地点最多只能指定10个)</li>
</ul>


<p>预先指定的提醒在发布到用户的PassBook后仍可以随时被修改.</p>

<p><strong>实时提醒:</strong></p>

<ul>
<li>当pass信息需要更改时,可通过推送通知用户,界面上可展示相应的修改信息. (除了pass的类型和序列号,其他字段都可以随时修改)</li>
</ul>


<h3>pass的样式</h3>

<h4>颜色:</h4>

<p><img src="/images/blog/2012-06-21-passkit-passbook-api-xue-xi-bi-ji/color.jpg" alt="image" /></p>

<h5>样式:</h5>

<p>store card &amp; coupon:</p>

<p><img src="/images/blog/2012-06-21-passkit-passbook-api-xue-xi-bi-ji/logo_bg_storecard.png" alt="image" /></p>

<p>event :</p>

<p><img src="/images/blog/2012-06-21-passkit-passbook-api-xue-xi-bi-ji/logo_bg_event.png" alt="image" /></p>

<h3>pass的字段</h3>

<p><img src="/images/blog/2012-06-21-passkit-passbook-api-xue-xi-bi-ji/fields.jpeg" alt="image" /></p>

<ul>
<li>serialNumber用来标识pass,同样的pass type identifier 下不能有两个pass的serialNumber相同</li>
<li>只有发布时指定了验证地址和验证token的pass才能在发布后进行修改(这个token只是用来验证pass本身可以接收更新,和设备是没有关系的)</li>
<li>webServiceURL token的验证地址,指向用户自己实现的rest服务器,必须实现更新pass所需的各种接口,必须是https…</li>
<li>relevantDate 提醒用户的时间. 具体显示提醒的时间范围由pass类型决定</li>
<li>locations 提醒用户的地址.范围大小由pass类型决定</li>
<li><p>显示App Store item :
<code>
"associatedStoreIdentifiers" : [ 375380948 ]
</code></p>

<h3>注意点</h3></li>
<li><p>iPad上没有Passbook</p></li>
<li>导出P12时不用选中私钥</li>
<li>签名和打包pass可用wwdc示例代码提供的签名工具</li>
<li>BARCODE不支持中文(应该跟用的编码有关)</li>
<li>日期格式: 2012-06-20T17:30+08:00</li>
<li>使用相对时间的格式  &#8220;isRelative&#8221; : true</li>
<li>coupon的primaryFields很大,中文只能放3个字</li>
<li>PKPassLibrary不是singleton,注册PKPassLibraryDidChangeNotification通知时,通知是针对某个具体的library对象的,所以需将你创建的library传过去.</li>
</ul>


<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'>    <span class="p">[</span><span class="n">noteCenter</span> <span class="nl">addObserver:</span><span class="n">self</span>
</span><span class='line'>                   <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="n">passLibraryDidChange</span><span class="p">)</span>
</span><span class='line'>                       <span class="nl">name:</span><span class="n">PKPassLibraryDidChangeNotification</span>
</span><span class='line'>                     <span class="nl">object:</span><span class="n">self</span><span class="p">.</span><span class="n">library</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>附上自己写的 <a href="/images/blog/2012-06-21-passkit-passbook-api-xue-xi-bi-ji/passkit_project.zip">pass工程</a>  (你可能需要换成自己开发者账号签名的pass才能在pass列表中查看已安装的pass,添加pass的话则不需要)</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/02/27/amazing-ios-simulator/">iOS模拟器居然还可以监测出来Mac上正在facetime,做得也太细致了</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-02-27T00:36:00+08:00" pubdate data-updated="true">Feb 27<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/02/27/amazing-ios-simulator/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><img class="" src="http://photo.luosky.com/wp-content/uploads/2012/02/Screen-Shot-2012-02-27-at-下午8.36.15-262x494.png" title="iOS" ></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2011/01/06/my-second-ios-app/">我的第二个iOS应用 爱折客 更新了</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-01-06T00:36:00+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/2011/01/06/my-second-ios-app/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>我做的第二个iOS应用[爱折客][]更新了,上海地区的iPhone用户欢迎试用:</p>

<p><a href="http://photo.luosky.com/wp-content/uploads/2011/01/Default.png"><img src="http://photo.luosky.com/wp-content/uploads/2011/01/Default.png" title="Default" alt="" /></a></p>

<h3>显示你附近的优惠券:</h3>

<p><img src="http://a1.phobos.apple.com/us/r1000/002/Purple/58/00/1e/mzl.yzjshxuf.320x480-75.jpg" title="附近" alt="" /></p>

<h3>优惠券页面:</h3>

<p><img src="http://a1.phobos.apple.com/us/r1000/040/Purple/61/c0/b0/mzl.yxnuejnc.320x480-75.jpg" title="优惠券" alt="" /></p>

<h3>你关注的店的动态:</h3>

<p><img src="http://a1.phobos.apple.com/us/r1000/036/Purple/73/64/ff/mzl.dqxvrrxb.320x480-75.jpg" title="我的店" alt="" /></p>

<h3>放入口袋的优惠券:</h3>

<p><img src="http://a1.phobos.apple.com/us/r1000/044/Purple/58/9f/6d/mzl.jlaqcrzy.320x480-75.jpg" title="口袋" alt="" /></p>

<h3>评论箱:</h3>

<p><img src="http://a1.phobos.apple.com/us/r1000/056/Purple/6e/39/ee/mzl.yvnvogck.320x480-75.jpg" title="评论箱" alt="" /></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2011/01/01/my-sync-solution/">我是同步控</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-01-01T00:36:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2011</time>
         &bull; <a rel="bookmark" href="/2011/01/01/my-sync-solution/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>我的同步方案：</p>

<p>同步照片：</p>

<ul>
<li><p>instagram</p>

<ul>
<li>twitter</li>
<li>facebook</li>
<li><p>flickr</p>

<ul>
<li><p>wordpress(via <a href="http://devthought.com/wp-o-matic-the-wordpress-rss-agreggator/">WP-o-Matic</a>)</p>

<ul>
<li>qzone （via <a href="http://liguoliang.com/2010/wordpress-post-to-qzone/">post2Qzone</a>）</li>
<li><a href="http://renjian.com/">renjian.com</a>(via <a href="http://www.smyx.net/wp-connect.html">WordPress连接微博</a>)</li>
<li>sina微博(via <a href="http://www.smyx.net/wp-connect.html">WordPress连接微博</a>)</li>
<li><p>digu (via <a href="http://www.smyx.net/wp-connect.html">WordPress连接微博</a>)</p>

<ul>
<li>kaixin001（via 嘀神）</li>
<li>douban（via 嘀神）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>同步微薄：</p>

<ul>
<li><p>qq签名</p>

<ul>
<li><p>follow5</p>

<ul>
<li>sina微博</li>
<li>twitter</li>
<li><p>digu</p>

<ul>
<li>kaixin001（via 嘀神）</li>
<li>douban (via 嘀神)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>2011-04-09 updated: 图片同步方式中换用<a href="http://www.smyx.net/wp-connect.html">WordPress连接微博</a> 来同步到几个微博</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2010/10/31/ios-notification-study-note/">iOS Notification 学习笔记</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-10-31T00:17:00+08:00" pubdate data-updated="true">Oct 31<span>st</span>, 2010</time>
         &bull; <a rel="bookmark" href="/2010/10/31/ios-notification-study-note/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h2>分类</h2>

<ol>
<li><p>本地notification</p>

<ul>
<li>4.0才开始支持</li>
<li>无需网络,无需走和Apple推送服务器的整个推送流程,一切都在本地发生</li>
</ul>
</li>
<li><p>push notification</p>

<ul>
<li>3.0开始支持</li>
<li>对于因为网络原因未发送到用户手机上的notification ,APNs会保留起来,待该device联网后发送.但对每台机器的每个应用只会保留一条,后来的覆盖之前的.</li>
<li>payload大小不超过256byte</li>
<li><strong>每次应用程序启动</strong>时都需向APNs注册,获得device token后将其传回应用的provider(application的server端)</li>
<li>provider要发送notification时,需附带这个device token</li>
<li>APNs会反馈持续发送失败的device 列表给provider,provider应停止向这些device发送notification</li>
<li>icon budge上显示的数字就是provider发过来的数字,不会累加.</li>
</ul>
</li>
</ol>


<h2>接收到notification时的处理</h2>

<p>本地notification和push notification对用户来讲没什么不同,当用户接收到一个notification时:</p>

<ul>
<li>若应用在后台运行,或者没有运行时

<ul>
<li>展现这个notification(提醒,声音和icon badge).若用户点了这个提醒(或是划动解锁了屏幕),则以notification带的payload作为参数调用<code>application:didFinishLaunchingWithOptions:</code>方法启动应用</li>
</ul>
</li>
<li>若正在前台运行

<ul>
<li>若是push notification,则<code>application:didReceiveRemoteNotification:</code>被调用</li>
<li>若是本地的notification,则 <code>application:didReceiveLocalNotification:</code> 会被调用</li>
</ul>
</li>
</ul>


<h2>建立推送服务器</h2>

<p>要发送notification的provider需先获取SSL证书.一个证书只能用于一个应用.且有测试(sandbox)证书和正式证书之分:</p>

<ul>
<li>测试(sandbox):<a href="http://gateway.sandbox.push.apple.com">gateway.sandbox.push.apple.com</a>, outbound TCP port 2195.</li>
<li>正式:<a href="http://gateway.push.apple.com">gateway.push.apple.com</a>, outbound TCP port 2195.</li>
</ul>


<p>iOS Develop Program的用户有三种角色:</p>

<ol>
<li>team agent</li>
<li>team admin</li>
<li>team member.</li>
</ol>


<p>只有team agent可以创建SSL证书<br/>
team agent 和team admin可以创建provisioning profile<br/>
team member只能下载和安装证书及profile</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
    <a href="/archives">Blog Archives</a>
    
  </div>
</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/06/21/passkit-passbook-api-study-notes/">PassKit (PassBook api) 学习笔记</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/27/amazing-ios-simulator/">iOS模拟器居然还可以监测出来Mac上正在facetime,做得也太细致了</a>
      </li>
    
      <li class="post">
        <a href="/2011/01/06/my-second-ios-app/">我的第二个iOS应用 爱折客 更新了</a>
      </li>
    
      <li class="post">
        <a href="/2011/01/01/my-sync-solution/">我是同步控</a>
      </li>
    
      <li class="post">
        <a href="/2010/10/31/ios-notification-study-note/">iOS Notification 学习笔记</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="luosky" data-count="4" data-replies="false">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="http://twitter.com/luosky" class="twitter-follow-button" data-show-count="false">Follow @luosky</a>
  
</section>





<section>
  <h1>On GitHub</h1>
  <ul id="gh_repos" data-user="Luosky" data-count="1" data-skip="true">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a class="github-follow" href="https://github.com/Luosky">Follow @Luosky</a>
  
</section>








  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Luosky -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'luosky';
			var disqus_developer = '1';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
